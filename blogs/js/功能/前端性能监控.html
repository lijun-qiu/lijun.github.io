<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>å‰ç«¯æ€§èƒ½ç›‘æ§ | lijun&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <meta name="description" content="A simple and beautiful vuepress blog theme .">
    
    <link rel="preload" href="/lijun.github.io/assets/css/0.styles.174fb0da.css" as="style"><link rel="preload" href="/lijun.github.io/assets/js/app.d76a9f71.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/4.7ab4d0b1.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/1.e1ba0332.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/50.8eca0d75.js" as="script"><link rel="prefetch" href="/lijun.github.io/assets/js/10.95f9e478.js"><link rel="prefetch" href="/lijun.github.io/assets/js/11.f6b04fef.js"><link rel="prefetch" href="/lijun.github.io/assets/js/12.3c75d87e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/13.64524e8f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/14.4fe4116d.js"><link rel="prefetch" href="/lijun.github.io/assets/js/15.438923d1.js"><link rel="prefetch" href="/lijun.github.io/assets/js/16.8448211c.js"><link rel="prefetch" href="/lijun.github.io/assets/js/17.9c9379b7.js"><link rel="prefetch" href="/lijun.github.io/assets/js/18.6800bba3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/19.952b82b0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/20.5d0e8bb2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/21.898ecfbd.js"><link rel="prefetch" href="/lijun.github.io/assets/js/22.599b8e17.js"><link rel="prefetch" href="/lijun.github.io/assets/js/23.c4e94cd0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/24.321e8d1e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/25.9861cc00.js"><link rel="prefetch" href="/lijun.github.io/assets/js/26.e0078337.js"><link rel="prefetch" href="/lijun.github.io/assets/js/27.95306eca.js"><link rel="prefetch" href="/lijun.github.io/assets/js/28.359936af.js"><link rel="prefetch" href="/lijun.github.io/assets/js/29.f25cf8ff.js"><link rel="prefetch" href="/lijun.github.io/assets/js/3.f0ed7429.js"><link rel="prefetch" href="/lijun.github.io/assets/js/30.8b33c0af.js"><link rel="prefetch" href="/lijun.github.io/assets/js/31.5ab0875e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/32.dafb4c90.js"><link rel="prefetch" href="/lijun.github.io/assets/js/33.46ef42a6.js"><link rel="prefetch" href="/lijun.github.io/assets/js/34.5958041b.js"><link rel="prefetch" href="/lijun.github.io/assets/js/35.2418e7b8.js"><link rel="prefetch" href="/lijun.github.io/assets/js/36.fc545af4.js"><link rel="prefetch" href="/lijun.github.io/assets/js/37.e2afe675.js"><link rel="prefetch" href="/lijun.github.io/assets/js/38.e21983f2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/39.63fb12b2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/40.15ddf238.js"><link rel="prefetch" href="/lijun.github.io/assets/js/41.907c7b87.js"><link rel="prefetch" href="/lijun.github.io/assets/js/42.7dd9847d.js"><link rel="prefetch" href="/lijun.github.io/assets/js/43.a8eada8a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/44.00a664d6.js"><link rel="prefetch" href="/lijun.github.io/assets/js/45.63795068.js"><link rel="prefetch" href="/lijun.github.io/assets/js/46.334f04fe.js"><link rel="prefetch" href="/lijun.github.io/assets/js/47.24579d27.js"><link rel="prefetch" href="/lijun.github.io/assets/js/48.11de53f2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/49.d2a256fc.js"><link rel="prefetch" href="/lijun.github.io/assets/js/5.36affe12.js"><link rel="prefetch" href="/lijun.github.io/assets/js/51.07584f37.js"><link rel="prefetch" href="/lijun.github.io/assets/js/52.6ace5b78.js"><link rel="prefetch" href="/lijun.github.io/assets/js/53.80ceb25e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/54.c39343a8.js"><link rel="prefetch" href="/lijun.github.io/assets/js/55.b3f4422f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/56.f85dfba9.js"><link rel="prefetch" href="/lijun.github.io/assets/js/57.5ad06130.js"><link rel="prefetch" href="/lijun.github.io/assets/js/58.f2997272.js"><link rel="prefetch" href="/lijun.github.io/assets/js/59.69897d2a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/6.d9bc5b6a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/60.af7ec6d0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/61.f0f798e7.js"><link rel="prefetch" href="/lijun.github.io/assets/js/62.171a615f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/63.41401f9e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/64.5cfee19b.js"><link rel="prefetch" href="/lijun.github.io/assets/js/65.dabe2d1e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/66.82af7c23.js"><link rel="prefetch" href="/lijun.github.io/assets/js/67.4131bc40.js"><link rel="prefetch" href="/lijun.github.io/assets/js/68.c96efc52.js"><link rel="prefetch" href="/lijun.github.io/assets/js/69.3d833570.js"><link rel="prefetch" href="/lijun.github.io/assets/js/7.04cf1173.js"><link rel="prefetch" href="/lijun.github.io/assets/js/70.3d2c5a89.js"><link rel="prefetch" href="/lijun.github.io/assets/js/71.d1076058.js"><link rel="prefetch" href="/lijun.github.io/assets/js/72.b371e547.js"><link rel="prefetch" href="/lijun.github.io/assets/js/73.7b5a1cf3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/74.77cad4ce.js"><link rel="prefetch" href="/lijun.github.io/assets/js/75.30af5ef3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/76.b9691c43.js"><link rel="prefetch" href="/lijun.github.io/assets/js/77.0c45dd6f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/78.456e57be.js"><link rel="prefetch" href="/lijun.github.io/assets/js/8.7ca0fd23.js"><link rel="prefetch" href="/lijun.github.io/assets/js/9.21a31406.js">
    <link rel="stylesheet" href="/lijun.github.io/assets/css/0.styles.174fb0da.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>lijun's blog</h3> <p class="description" data-v-59e6cb88>A simple and beautiful vuepress blog theme .</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>lijun</span>
        Â Â 
        <span data-v-59e6cb88>2023 - </span>
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lijun.github.io/" class="home-link router-link-active"><img src="/lijun.github.io/logo.png" alt="lijun's blog" class="logo"> <span class="site-name">lijun's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lijun.github.io/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/lijun.github.io/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeScreening
</a></div><div class="nav-item"><a href="/lijun.github.io/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Label
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/js/" class="nav-link router-link-active"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/third_party/" class="nav-link"><i class="undefined"></i>
  thirdPartyPlugin 
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Document
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  ä¸ªäººæ–‡æ¡£
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/share-work/" class="nav-link"><i class="undefined"></i>
  shareWork
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      GitHub
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lijun-qiu/myblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/lijun.github.io/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    lijun
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>66</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>31</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/lijun.github.io/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/lijun.github.io/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeScreening
</a></div><div class="nav-item"><a href="/lijun.github.io/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Label
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/js/" class="nav-link router-link-active"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/third_party/" class="nav-link"><i class="undefined"></i>
  thirdPartyPlugin 
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Document
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  ä¸ªäººæ–‡æ¡£
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/share-work/" class="nav-link"><i class="undefined"></i>
  shareWork
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      GitHub
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lijun-qiu/myblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>åŠŸèƒ½</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/jså‘å¸ƒä¸è®¢é˜….html" class="sidebar-link">jså‘å¸ƒä¸è®¢é˜…</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/å°è£…storage.html" class="sidebar-link">å°è£…storage</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/å±•å¼€æ”¶èµ·æ•ˆæœ.html" class="sidebar-link">csså±•å¼€æ”¶èµ·</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/æ–‡å­—å‘ä¸Šè½®æ’­.html" class="sidebar-link">æ–‡å­—å‘ä¸Šè½®æ’­</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/è½®æ’­å›¾.html" class="sidebar-link">è½®æ’­å›¾</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/æ‚¬æµ®éšè—åŠ æ‹–åŠ¨.html" class="sidebar-link">æ‚¬æµ®éšè—åŠ æ‹–åŠ¨</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/h5ä¸‹æ‹‰åˆ·æ–°.html" class="sidebar-link">h5ä¸‹æ‹‰åˆ·æ–°</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/ç®€æ˜“gpt.html" class="sidebar-link">ç®€æ˜“gpt</a></li><li><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/å‰ç«¯æ€§èƒ½ç›‘æ§.html" class="active sidebar-link">å‰ç«¯æ€§èƒ½ç›‘æ§</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ä¼˜åŒ–</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>æ•°ç»„</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ç¬¬ä¸‰æ–¹æ’ä»¶</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>å‰ç«¯æ€§èƒ½ç›‘æ§</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>lijun</span>
        Â Â 
        <span data-v-59e6cb88>2023 - </span>
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">å‰ç«¯æ€§èƒ½ç›‘æ§</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>lijun</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>8/18/2024</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>å‰ç«¯æ€§èƒ½ç›‘æ§</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="å‰ç«¯æ€§èƒ½ç›‘æ§sdk-è¯¦ç»†åˆ†æ"><a href="#å‰ç«¯æ€§èƒ½ç›‘æ§sdk-è¯¦ç»†åˆ†æ" class="header-anchor">#</a> å‰ç«¯æ€§èƒ½ç›‘æ§SDK è¯¦ç»†åˆ†æ</h1> <h2 id="ğŸ“‹-ç›®å½•"><a href="#ğŸ“‹-ç›®å½•" class="header-anchor">#</a> ğŸ“‹ ç›®å½•</h2> <ul><li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">é¡¹ç›®æ¦‚è¿°</a></li> <li><a href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">æ¶æ„è®¾è®¡</a></li> <li><a href="#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3">æ ¸å¿ƒæ¨¡å—è¯¦è§£</a></li> <li><a href="#%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90">å·¥å…·å‡½æ•°åˆ†æ</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90">æ•°æ®æµåˆ†æ</a></li> <li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">ä½¿ç”¨æ–¹å¼</a></li> <li><a href="#%E6%8A%80%E6%9C%AF%E7%89%B9%E7%82%B9">æŠ€æœ¯ç‰¹ç‚¹</a></li> <li><a href="#%E6%80%BB%E7%BB%93">æ€»ç»“</a></li></ul> <h2 id="é¡¹ç›®æ¦‚è¿°"><a href="#é¡¹ç›®æ¦‚è¿°" class="header-anchor">#</a> é¡¹ç›®æ¦‚è¿°</h2> <p>è¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å‰ç«¯æ€§èƒ½ç›‘æ§SDKï¼Œä¸“é—¨ç”¨äºç›‘æ§Webåº”ç”¨çš„ç¨³å®šæ€§å’Œé”™è¯¯æƒ…å†µã€‚è¯¥SDKé‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œèƒ½å¤Ÿè‡ªåŠ¨æ•è·JavaScripté”™è¯¯ã€ç½‘ç»œè¯·æ±‚å¼‚å¸¸ã€ç™½å±é—®é¢˜ç­‰å…³é”®ç›‘æ§æŒ‡æ ‡ï¼Œä¸ºå¼€å‘è€…æä¾›å…¨é¢çš„å‰ç«¯åº”ç”¨å¥åº·çŠ¶æ€ç›‘æ§ã€‚</p> <h3 id="ï¿½ï¿½-ç›‘æ§ç›®æ ‡"><a href="#ï¿½ï¿½-ç›‘æ§ç›®æ ‡" class="header-anchor">#</a> ï¿½ï¿½ ç›‘æ§ç›®æ ‡</h3> <ul><li><strong>ç¨³å®šæ€§ç›‘æ§</strong>ï¼šJSé”™è¯¯ã€èµ„æºåŠ è½½é”™è¯¯ã€Promiseé”™è¯¯</li> <li><strong>ç½‘ç»œç›‘æ§</strong>ï¼šXHRè¯·æ±‚å¼‚å¸¸ã€å“åº”æ—¶é—´ç»Ÿè®¡</li> <li><strong>ç”¨æˆ·ä½“éªŒç›‘æ§</strong>ï¼šç™½å±æ£€æµ‹ã€é¡µé¢å¯ç”¨æ€§</li> <li><strong>é”™è¯¯å®šä½</strong>ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡ä¿¡æ¯</li></ul> <h2 id="æ¶æ„è®¾è®¡"><a href="#æ¶æ„è®¾è®¡" class="header-anchor">#</a> æ¶æ„è®¾è®¡</h2> <h3 id="æ•´ä½“æ¶æ„å›¾"><a href="#æ•´ä½“æ¶æ„å›¾" class="header-anchor">#</a> æ•´ä½“æ¶æ„å›¾</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>monitor/
â”œâ”€â”€ index.js              # ç»Ÿä¸€å…¥å£ï¼Œåˆå§‹åŒ–æ‰€æœ‰ç›‘æ§æ¨¡å—
â”œâ”€â”€ lib/                   # æ ¸å¿ƒç›‘æ§åŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ jsError.js         # JavaScripté”™è¯¯ç›‘æ§
â”‚   â”œâ”€â”€ xhr.js            # ç½‘ç»œè¯·æ±‚ç›‘æ§
â”‚   â””â”€â”€ blankScreen.js    # ç™½å±æ£€æµ‹
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°åº“
    â”œâ”€â”€ tracker.js        # æ•°æ®ä¸ŠæŠ¥å™¨
    â”œâ”€â”€ getSelector.js     # DOMé€‰æ‹©å™¨ç”Ÿæˆ
    â”œâ”€â”€ getLastEvent.js   # æœ€åäº¤äº’äº‹ä»¶æ•è·
    â””â”€â”€ onload.js         # é¡µé¢åŠ è½½å®Œæˆæ£€æµ‹
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="æ¨¡å—ä¾èµ–å…³ç³»"><a href="#æ¨¡å—ä¾èµ–å…³ç³»" class="header-anchor">#</a> æ¨¡å—ä¾èµ–å…³ç³»</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>index.js (å…¥å£)
â”œâ”€â”€ jsError.js â†’ getSelector.js, getLastEvent.js, tracker.js
â”œâ”€â”€ xhr.js â†’ tracker.js
â””â”€â”€ blankScreen.js â†’ tracker.js, onload.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="æ ¸å¿ƒæ¨¡å—è¯¦è§£"><a href="#æ ¸å¿ƒæ¨¡å—è¯¦è§£" class="header-anchor">#</a> æ ¸å¿ƒæ¨¡å—è¯¦è§£</h2> <h3 id="_1-javascripté”™è¯¯ç›‘æ§-jserror-js"><a href="#_1-javascripté”™è¯¯ç›‘æ§-jserror-js" class="header-anchor">#</a> 1. JavaScripté”™è¯¯ç›‘æ§ (<code>jsError.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°"><a href="#åŠŸèƒ½æ¦‚è¿°" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>è´Ÿè´£æ•è·å’Œå¤„ç†JavaScriptè¿è¡Œæ—¶é”™è¯¯ï¼ŒåŒ…æ‹¬åŒæ­¥é”™è¯¯ã€å¼‚æ­¥é”™è¯¯å’Œèµ„æºåŠ è½½é”™è¯¯ã€‚</p> <h4 id="æ ¸å¿ƒå®ç°"><a href="#æ ¸å¿ƒå®ç°" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>å…¨å±€é”™è¯¯ç›‘å¬</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ•è·æœ€åä¸€ä¸ªäº¤äº’äº‹ä»¶</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> event<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// èµ„æºåŠ è½½é”™è¯¯å¤„ç†</span>
        <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'resourceError'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
            <span class="token literal-property property">tagName</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// JSæ‰§è¡Œé”™è¯¯å¤„ç†</span>
        <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'jsError'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span>
            <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">stack</span><span class="token operator">:</span> event<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>Promiseé”™è¯¯æ•è·</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> message<span class="token punctuation">;</span>
    <span class="token keyword">let</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
    <span class="token keyword">let</span> lineno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> colno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> filename<span class="token punctuation">;</span>
    <span class="token keyword">let</span> stack<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>reason <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        message <span class="token operator">=</span> reason<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> reason <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> matchResult <span class="token operator">=</span> reason<span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">at\s+(.+):(\d+):(\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            filename <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            lineno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            colno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        message <span class="token operator">=</span> reason<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
        stack <span class="token operator">=</span> <span class="token function">getLines</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'promiseError'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> filename<span class="token punctuation">,</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">stack</span><span class="token operator">:</span> stack<span class="token punctuation">,</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>å †æ ˆä¿¡æ¯å¤„ç†</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getLines</span><span class="token punctuation">(</span><span class="token parameter">stack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> stack<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s+at\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'^'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="ç›‘æ§æ•°æ®ç±»å‹"><a href="#ç›‘æ§æ•°æ®ç±»å‹" class="header-anchor">#</a> ç›‘æ§æ•°æ®ç±»å‹</h4> <ul><li><p><strong>JSæ‰§è¡Œé”™è¯¯</strong> (<code>errorType: 'jsError'</code>)</p> <ul><li>é”™è¯¯æ¶ˆæ¯ (<code>message</code>)</li> <li>æ–‡ä»¶å (<code>filename</code>)</li> <li>é”™è¯¯ä½ç½® (<code>position: &quot;è¡Œ:åˆ—&quot;</code>)</li> <li>å †æ ˆä¿¡æ¯ (<code>stack</code>)</li> <li>æœ€åæ“ä½œå…ƒç´  (<code>selector</code>)</li></ul></li> <li><p><strong>èµ„æºåŠ è½½é”™è¯¯</strong> (<code>errorType: 'resourceError'</code>)</p> <ul><li>èµ„æºURL (<code>filename</code>)</li> <li>æ ‡ç­¾å (<code>tagName</code>)</li> <li>å…ƒç´ é€‰æ‹©å™¨ (<code>selector</code>)</li></ul></li> <li><p><strong>Promiseé”™è¯¯</strong> (<code>errorType: 'promiseError'</code>)</p> <ul><li>é”™è¯¯æ¶ˆæ¯å’Œå †æ ˆä¿¡æ¯</li> <li>æ–‡ä»¶åå’Œä½ç½®ä¿¡æ¯</li></ul></li></ul> <h4 id="æŠ€æœ¯äº®ç‚¹"><a href="#æŠ€æœ¯äº®ç‚¹" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>é”™è¯¯åˆ†ç±»</strong>ï¼šè‡ªåŠ¨åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯</li> <li><strong>å †æ ˆè§£æ</strong>ï¼šæå–å¹¶æ ¼å¼åŒ–é”™è¯¯å †æ ˆä¿¡æ¯</li> <li><strong>ä¸Šä¸‹æ–‡æ•è·</strong>ï¼šè®°å½•ç”¨æˆ·æœ€åæ“ä½œçš„å…ƒç´ </li> <li><strong>æ­£åˆ™åŒ¹é…</strong>ï¼šé€šè¿‡æ­£åˆ™è¡¨è¾¾å¼è§£æPromiseé”™è¯¯ä¿¡æ¯</li></ul> <h3 id="_2-ç½‘ç»œè¯·æ±‚ç›‘æ§-xhr-js"><a href="#_2-ç½‘ç»œè¯·æ±‚ç›‘æ§-xhr-js" class="header-anchor">#</a> 2. ç½‘ç»œè¯·æ±‚ç›‘æ§ (<code>xhr.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-2"><a href="#åŠŸèƒ½æ¦‚è¿°-2" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>é€šè¿‡æ‹¦æˆªXMLHttpRequestæ¥ç›‘æ§ç½‘ç»œè¯·æ±‚çš„çŠ¶æ€ã€æ€§èƒ½å’Œé”™è¯¯æƒ…å†µã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-2"><a href="#æ ¸å¿ƒå®ç°-2" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>è¯·æ±‚æ‹¦æˆª</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> XMLHttpRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
<span class="token keyword">let</span> oldOpen <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open<span class="token punctuation">;</span>
<span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">open</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">async</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// æŠŠä¸ŠæŠ¥æ¥å£è¿‡æ»¤æ‰ï¼Œé¿å…å¾ªç¯ä¸ŠæŠ¥</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">plaque_log</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logData <span class="token operator">=</span> <span class="token punctuation">{</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldOpen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>å“åº”ç›‘æ§</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> oldSend <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
<span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å‘é€å‰è®°å½•å¼€å§‹æ—¶é—´</span>
        <span class="token keyword">let</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// æŒç»­æ—¶é—´</span>
            <span class="token keyword">let</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
            <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>  <span class="token comment">// 200 500</span>
            <span class="token keyword">let</span> statusText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>  <span class="token comment">// Ok Server Error</span>
            
            <span class="token comment">// æ¥å£è¯·æ±‚ç›‘æ§</span>
            tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;xhr&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">eventType</span><span class="token operator">:</span> type<span class="token punctuation">,</span>  <span class="token comment">// load, error, abort è¯·æ±‚ç±»å‹</span>
                <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> status <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> statusText<span class="token punctuation">,</span>
                duration<span class="token punctuation">,</span>
                <span class="token literal-property property">response</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">params</span><span class="token operator">:</span> body <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">// ç›‘å¬æˆåŠŸï¼Œå¤±è´¥ï¼Œçš„æ‰€æœ‰æ¥å£ï¼Œè¿™é‡Œåªç›‘æ§error </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldSend</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="ç›‘æ§æ•°æ®ç±»å‹-2"><a href="#ç›‘æ§æ•°æ®ç±»å‹-2" class="header-anchor">#</a> ç›‘æ§æ•°æ®ç±»å‹</h4> <ul><li><strong>è¯·æ±‚ä¿¡æ¯</strong>ï¼šæ–¹æ³•ã€URLã€å¼‚æ­¥æ ‡å¿—</li> <li><strong>å“åº”ä¿¡æ¯</strong>ï¼šçŠ¶æ€ç ã€çŠ¶æ€æ–‡æœ¬ã€å“åº”å†…å®¹</li> <li><strong>æ€§èƒ½æŒ‡æ ‡</strong>ï¼šè¯·æ±‚æŒç»­æ—¶é—´</li> <li><strong>é”™è¯¯ç±»å‹</strong>ï¼šerroräº‹ä»¶</li></ul> <h4 id="æŠ€æœ¯äº®ç‚¹-2"><a href="#æŠ€æœ¯äº®ç‚¹-2" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>åŸå‹é“¾æ‹¦æˆª</strong>ï¼šé€šè¿‡é‡å†™XMLHttpRequeståŸå‹æ–¹æ³•å®ç°ç›‘æ§</li> <li><strong>å¾ªç¯ä¸ŠæŠ¥é˜²æŠ¤</strong>ï¼šè¿‡æ»¤ç›‘æ§æ¥å£æœ¬èº«ï¼Œé¿å…æ— é™å¾ªç¯</li> <li><strong>æ€§èƒ½ç»Ÿè®¡</strong>ï¼šç²¾ç¡®è®¡ç®—è¯·æ±‚è€—æ—¶</li> <li><strong>é€‰æ‹©æ€§ç›‘æ§</strong>ï¼šåªç›‘æ§erroräº‹ä»¶ï¼Œå‡å°‘æ•°æ®é‡</li> <li><strong>æ—¶é—´è®°å½•</strong>ï¼šåœ¨sendæ–¹æ³•ä¸­è®°å½•å¼€å§‹æ—¶é—´</li></ul> <h3 id="_3-ç™½å±æ£€æµ‹-blankscreen-js"><a href="#_3-ç™½å±æ£€æµ‹-blankscreen-js" class="header-anchor">#</a> 3. ç™½å±æ£€æµ‹ (<code>blankScreen.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-3"><a href="#åŠŸèƒ½æ¦‚è¿°-3" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>é€šè¿‡é‡‡æ ·æ£€æµ‹é¡µé¢å…³é”®ä½ç½®æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç™½å±é—®é¢˜ã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-3"><a href="#æ ¸å¿ƒå®ç°-3" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>é€‰æ‹©å™¨ç”Ÿæˆ</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> className<span class="token punctuation">,</span> nodeName<span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è¿‡æ»¤ç©ºç™½ç¬¦ + æ‹¼æ¥ å¯èƒ½å¤šä¸ªclassName  a  b   c =&gt; .a.b.c</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> className <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>é‡‡æ ·æ£€æµ‹ç®—æ³•</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isWrapper</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        emptyPoints<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// åˆšå¼€å§‹é¡µé¢å†…å®¹ä¸ºç©ºï¼Œç›‘å¬æ¥å£åŠ è½½ï¼Œç­‰é¡µé¢æ¸²æŸ“å®Œæˆï¼Œå†å»åšåˆ¤æ–­</span>
<span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> xElements<span class="token punctuation">,</span> yElements<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ç™½å± æ€»å…±18ä¸ªç‚¹  å¦‚æœç©ºç™½ç‚¹æ•°é‡å¤§äº 16ä¸ª ä»£è¡¨ç™½å±</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyPoints <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> centerElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ç™½å±ç›‘æ§</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">emptyPoints</span><span class="token operator">:</span> emptyPoints <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">screen</span><span class="token operator">:</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            <span class="token literal-property property">viewPoint</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>centerElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="ç›‘æ§æ•°æ®ç±»å‹-3"><a href="#ç›‘æ§æ•°æ®ç±»å‹-3" class="header-anchor">#</a> ç›‘æ§æ•°æ®ç±»å‹</h4> <ul><li><strong>ç©ºç™½ç‚¹æ•°é‡</strong> (<code>emptyPoints</code>)</li> <li><strong>å±å¹•åˆ†è¾¨ç‡</strong> (<code>screen</code>)</li> <li><strong>è§†å£å¤§å°</strong> (<code>viewPoint</code>)</li> <li><strong>ä¸­å¿ƒç‚¹é€‰æ‹©å™¨</strong> (<code>selector</code>)</li></ul> <h4 id="æŠ€æœ¯äº®ç‚¹-3"><a href="#æŠ€æœ¯äº®ç‚¹-3" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>åå­—å‹é‡‡æ ·</strong>ï¼šåœ¨é¡µé¢å…³é”®ä½ç½®è¿›è¡Œé‡‡æ ·æ£€æµ‹</li> <li><strong>å»¶è¿Ÿæ£€æµ‹</strong>ï¼šç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½åå†æ£€æµ‹</li> <li><strong>é˜ˆå€¼åˆ¤æ–­</strong>ï¼šé€šè¿‡ç©ºç™½ç‚¹æ•°é‡é˜ˆå€¼åˆ¤æ–­ç™½å±</li> <li><strong>ç¯å¢ƒä¿¡æ¯</strong>ï¼šè®°å½•å±å¹•å’Œè§†å£ä¿¡æ¯</li> <li><strong>elementsFromPoint API</strong>ï¼šä½¿ç”¨ç°ä»£APIè·å–æŒ‡å®šä½ç½®å…ƒç´ </li></ul> <h2 id="å·¥å…·å‡½æ•°åˆ†æ"><a href="#å·¥å…·å‡½æ•°åˆ†æ" class="header-anchor">#</a> å·¥å…·å‡½æ•°åˆ†æ</h2> <h3 id="_1-æ•°æ®ä¸ŠæŠ¥å™¨-tracker-js"><a href="#_1-æ•°æ®ä¸ŠæŠ¥å™¨-tracker-js" class="header-anchor">#</a> 1. æ•°æ®ä¸ŠæŠ¥å™¨ (<code>tracker.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-4"><a href="#åŠŸèƒ½æ¦‚è¿°-4" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>ç»Ÿä¸€çš„æ•°æ®ä¸ŠæŠ¥æ¨¡å—ï¼Œè´Ÿè´£æ”¶é›†å’Œå‘é€ç›‘æ§æ•°æ®ã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-4"><a href="#æ ¸å¿ƒå®ç°-4" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>å…¬å…±ä¿¡æ¯æ”¶é›†</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getExtraData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment">// å½“å‰æµè§ˆå™¨title</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>  <span class="token comment">// è®¿é—®è·¯å¾„</span>
        <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// å½“å‰æ—¶é—´æˆ³</span>
        <span class="token literal-property property">userAgent</span><span class="token operator">:</span> userAgent<span class="token punctuation">,</span> <span class="token comment">// æµè§ˆå™¨ä¿¡æ¯</span>
        <span class="token literal-property property">uid</span><span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>uid <span class="token operator">??</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// å½“å‰ç”¨æˆ·id</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>æ•°æ®æ ‡å‡†åŒ–</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å¯¹è±¡çš„å€¼ç»Ÿä¸€ä¸ºå­—ç¬¦ä¸²</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> log<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> log<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>log<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>ç¯å¢ƒåŒºåˆ†ä¸ŠæŠ¥</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">shuidi.cn</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ç”Ÿäº§ç¯å¢ƒä¸ŠæŠ¥ä¿¡æ¯</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¼‚å¸¸ç›‘æ§ä¸ŠæŠ¥: '</span> <span class="token operator">+</span> log<span class="token punctuation">.</span>type<span class="token punctuation">,</span> log<span class="token punctuation">)</span>
    axios<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/kp/plaque_log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'front_error_log'</span><span class="token punctuation">,</span>
        log<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// æµ‹è¯•ç¯å¢ƒç›‘æ§æç¤º</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å¼‚å¸¸ä¿¡æ¯ç›‘æ§æç¤º: '</span> <span class="token operator">+</span> log<span class="token punctuation">.</span>type<span class="token punctuation">,</span> log<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="æŠ€æœ¯äº®ç‚¹-4"><a href="#æŠ€æœ¯äº®ç‚¹-4" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>ç¯å¢ƒè‡ªé€‚åº”</strong>ï¼šè‡ªåŠ¨åŒºåˆ†ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ</li> <li><strong>æ•°æ®æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€æ•°æ®æ ¼å¼</li> <li><strong>ç”¨æˆ·ä¿¡æ¯é›†æˆ</strong>ï¼šè‡ªåŠ¨é™„åŠ ç”¨æˆ·ä¸Šä¸‹æ–‡</li> <li><strong>é”™è¯¯å¤„ç†</strong>ï¼šæä¾›é™çº§æ–¹æ¡ˆ</li> <li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼šä½¿ç”¨new SendTracker()ç¡®ä¿å…¨å±€å”¯ä¸€</li></ul> <h3 id="_2-domé€‰æ‹©å™¨ç”Ÿæˆ-getselector-js"><a href="#_2-domé€‰æ‹©å™¨ç”Ÿæˆ-getselector-js" class="header-anchor">#</a> 2. DOMé€‰æ‹©å™¨ç”Ÿæˆ (<code>getSelector.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-5"><a href="#åŠŸèƒ½æ¦‚è¿°-5" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>ç”ŸæˆDOMå…ƒç´ çš„å®Œæ•´é€‰æ‹©å™¨è·¯å¾„ï¼Œç”¨äºé”™è¯¯å®šä½ã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-5"><a href="#æ ¸å¿ƒå®ç°-5" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>è·¯å¾„æ„å»ºç®—æ³•</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// åè½¬ + è¿‡æ»¤ + æ˜ å°„ + æ‹¼æ¥</span>
    <span class="token keyword">return</span> path
        <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> element <span class="token operator">!==</span> document <span class="token operator">&amp;&amp;</span> element <span class="token operator">!==</span> window<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;element&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>className <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> element<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                selector <span class="token operator">=</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pathsOrTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pathsOrTarget <span class="token operator">=</span> pathsOrTarget<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="æŠ€æœ¯äº®ç‚¹-5"><a href="#æŠ€æœ¯äº®ç‚¹-5" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>ä¼˜å…ˆçº§å¤„ç†</strong>ï¼šID &gt; className &gt; tagName</li> <li><strong>è·¯å¾„åè½¬</strong>ï¼šä»å­å…ƒç´ åˆ°çˆ¶å…ƒç´ </li> <li><strong>è¿‡æ»¤å¤„ç†</strong>ï¼šæ’é™¤documentå’Œwindowå¯¹è±¡</li> <li><strong>å…¼å®¹æ€§å¤„ç†</strong>ï¼šæ”¯æŒä¸åŒå…ƒç´ ç±»å‹</li> <li><strong>é€’å½’éå†</strong>ï¼šé€šè¿‡parentNodeå‘ä¸Šéå†DOMæ ‘</li> <li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šä½¿ç”¨mapã€filterã€joinç­‰å‡½æ•°å¼æ–¹æ³•</li></ul> <h3 id="_3-äº¤äº’äº‹ä»¶æ•è·-getlastevent-js"><a href="#_3-äº¤äº’äº‹ä»¶æ•è·-getlastevent-js" class="header-anchor">#</a> 3. äº¤äº’äº‹ä»¶æ•è· (<code>getLastEvent.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-6"><a href="#åŠŸèƒ½æ¦‚è¿°-6" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>æ•è·ç”¨æˆ·æœ€åçš„äº¤äº’äº‹ä»¶ï¼Œä¸ºé”™è¯¯æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-6"><a href="#æ ¸å¿ƒå®ç°-6" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <p><strong>äº‹ä»¶ç›‘å¬</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> lastEvent<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token string">'mouseover'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">eventType</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            lastEvent <span class="token operator">=</span> event<span class="token punctuation">;</span>
            <span class="token comment">// html5ä¹‹å‰ä½¿ç”¨mouseEvent.pathç­‰è·å–äº‹ä»¶ä½ç½®ï¼Œ</span>
            <span class="token comment">// html5ä¹‹åæ‰€æœ‰äº‹ä»¶ä½¿ç”¨ PointerEven æ›¿ä»£ï¼Œå–æ¶ˆpath</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">capture</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// æ•è·é˜¶æ®µæ‰§è¡Œ é˜²æ­¢äº‹ä»¶ä¸¢å¤±</span>
            <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// é»˜è®¤ä¸é˜»æ­¢é»˜è®¤äº‹ä»¶</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> lastEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="æŠ€æœ¯äº®ç‚¹-6"><a href="#æŠ€æœ¯äº®ç‚¹-6" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>å¤šäº‹ä»¶ç›‘å¬</strong>ï¼šè¦†ç›–ä¸»è¦ç”¨æˆ·äº¤äº’äº‹ä»¶</li> <li><strong>æ•è·é˜¶æ®µæ‰§è¡Œ</strong>ï¼šé˜²æ­¢äº‹ä»¶ä¸¢å¤±</li> <li><strong>è¢«åŠ¨ç›‘å¬</strong>ï¼šä¸é˜»æ­¢é»˜è®¤äº‹ä»¶</li> <li><strong>HTML5å…¼å®¹</strong>ï¼šå¤„ç†æ–°æ—§æ ‡å‡†å·®å¼‚</li> <li><strong>å…¨å±€çŠ¶æ€</strong>ï¼šä½¿ç”¨æ¨¡å—çº§å˜é‡ä¿å­˜æœ€åäº‹ä»¶</li></ul> <h3 id="_4-é¡µé¢åŠ è½½æ£€æµ‹-onload-js"><a href="#_4-é¡µé¢åŠ è½½æ£€æµ‹-onload-js" class="header-anchor">#</a> 4. é¡µé¢åŠ è½½æ£€æµ‹ (<code>onload.js</code>)</h3> <h4 id="åŠŸèƒ½æ¦‚è¿°-7"><a href="#åŠŸèƒ½æ¦‚è¿°-7" class="header-anchor">#</a> åŠŸèƒ½æ¦‚è¿°</h4> <p>æ£€æµ‹é¡µé¢æ˜¯å¦å®Œå…¨åŠ è½½å®Œæˆã€‚</p> <h4 id="æ ¸å¿ƒå®ç°-7"><a href="#æ ¸å¿ƒå®ç°-7" class="header-anchor">#</a> æ ¸å¿ƒå®ç°</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="æŠ€æœ¯äº®ç‚¹-7"><a href="#æŠ€æœ¯äº®ç‚¹-7" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h4> <ul><li><strong>çŠ¶æ€æ£€æŸ¥</strong>ï¼šä¼˜å…ˆæ£€æŸ¥readyState</li> <li><strong>äº‹ä»¶ç›‘å¬</strong>ï¼šå¤‡ç”¨loadäº‹ä»¶ç›‘å¬</li> <li><strong>ç®€æ´è®¾è®¡</strong>ï¼šæœ€å°åŒ–å®ç°</li> <li><strong>å›è°ƒæ¨¡å¼</strong>ï¼šæ”¯æŒå¼‚æ­¥å›è°ƒ</li></ul> <h2 id="æ•°æ®æµåˆ†æ"><a href="#æ•°æ®æµåˆ†æ" class="header-anchor">#</a> æ•°æ®æµåˆ†æ</h2> <h3 id="æ•°æ®æ”¶é›†æµç¨‹"><a href="#æ•°æ®æ”¶é›†æµç¨‹" class="header-anchor">#</a> æ•°æ®æ”¶é›†æµç¨‹</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>ç”¨æˆ·æ“ä½œ â†’ äº‹ä»¶æ•è· â†’ é”™è¯¯å‘ç”Ÿ â†’ é”™è¯¯ç›‘å¬ â†’ æ•°æ®æ”¶é›† â†’ æ ¼å¼åŒ– â†’ ä¸ŠæŠ¥
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="æ•°æ®æ ¼å¼æ ‡å‡†"><a href="#æ•°æ®æ ¼å¼æ ‡å‡†" class="header-anchor">#</a> æ•°æ®æ ¼å¼æ ‡å‡†</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token comment">// å…¬å…±ä¿¡æ¯</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;é¡µé¢æ ‡é¢˜&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;å½“å‰URL&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token string">&quot;æ—¶é—´æˆ³&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">&quot;æµè§ˆå™¨ä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&quot;ç”¨æˆ·ID&quot;</span><span class="token punctuation">,</span>
    
    <span class="token comment">// ç›‘æ§æ•°æ®</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// æ—¥å¿—ç§ç±»</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;error|xhr|blank&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// ç›‘æ§ç±»å‹</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&quot;jsError|resourceError|promiseError&quot;</span><span class="token punctuation">,</span> <span class="token comment">// é”™è¯¯å­ç±»å‹</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;é”™è¯¯æ¶ˆæ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;æ–‡ä»¶å&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">&quot;è¡Œ:åˆ—&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token string">&quot;å †æ ˆä¿¡æ¯&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&quot;å…ƒç´ é€‰æ‹©å™¨&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ... å…¶ä»–å­—æ®µ</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="ä¸ŠæŠ¥ç­–ç•¥"><a href="#ä¸ŠæŠ¥ç­–ç•¥" class="header-anchor">#</a> ä¸ŠæŠ¥ç­–ç•¥</h3> <ul><li><strong>å®æ—¶ä¸ŠæŠ¥</strong>ï¼šé”™è¯¯å‘ç”Ÿæ—¶ç«‹å³ä¸ŠæŠ¥</li> <li><strong>ç¯å¢ƒåŒºåˆ†</strong>ï¼šç”Ÿäº§ç¯å¢ƒçœŸå®ä¸ŠæŠ¥ï¼Œæµ‹è¯•ç¯å¢ƒæ§åˆ¶å°è¾“å‡º</li> <li><strong>æ•°æ®è¿‡æ»¤</strong>ï¼šæ’é™¤ç›‘æ§æ¥å£æœ¬èº«ï¼Œé¿å…å¾ªç¯ä¸ŠæŠ¥</li></ul> <h2 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="header-anchor">#</a> ä½¿ç”¨æ–¹å¼</h2> <h3 id="åŸºç¡€ä½¿ç”¨"><a href="#åŸºç¡€ä½¿ç”¨" class="header-anchor">#</a> åŸºç¡€ä½¿ç”¨</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// åœ¨åº”ç”¨å…¥å£å¼•å…¥å³å¯è‡ªåŠ¨å¼€å§‹ç›‘æ§</span>
<span class="token keyword">import</span> <span class="token string">'./monitor/index.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="è‡ªå®šä¹‰é…ç½®"><a href="#è‡ªå®šä¹‰é…ç½®" class="header-anchor">#</a> è‡ªå®šä¹‰é…ç½®</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å¯ä»¥æ‰©å±•ç›‘æ§åŠŸèƒ½</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectJsError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./monitor/lib/jsError'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectXHR <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./monitor/lib/xhr'</span><span class="token punctuation">;</span>

<span class="token comment">// é€‰æ‹©æ€§å¯ç”¨ç›‘æ§</span>
<span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// injectXHR(); // æ³¨é‡Šæ‰ä¸éœ€è¦çš„ç›‘æ§</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="æŠ€æœ¯ç‰¹ç‚¹"><a href="#æŠ€æœ¯ç‰¹ç‚¹" class="header-anchor">#</a> æŠ€æœ¯ç‰¹ç‚¹</h2> <h3 id="ä¼˜åŠ¿"><a href="#ä¼˜åŠ¿" class="header-anchor">#</a> ä¼˜åŠ¿</h3> <ol><li><strong>è½»é‡çº§è®¾è®¡</strong>ï¼šä»£ç ç®€æ´ï¼Œæ€§èƒ½å½±å“å°</li> <li><strong>æ¨¡å—åŒ–æ¶æ„</strong>ï¼šåŠŸèƒ½ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•</li> <li><strong>è‡ªåŠ¨åŒ–ç›‘æ§</strong>ï¼šæ— éœ€æ‰‹åŠ¨åŸ‹ç‚¹ï¼Œè‡ªåŠ¨æ•è·å¼‚å¸¸</li> <li><strong>å…¨é¢è¦†ç›–</strong>ï¼šæ¶µç›–JSé”™è¯¯ã€ç½‘ç»œè¯·æ±‚ã€ç™½å±ç­‰å…³é”®ç›‘æ§ç‚¹</li> <li><strong>ç¯å¢ƒé€‚é…</strong>ï¼šè‡ªåŠ¨åŒºåˆ†ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ</li> <li><strong>æ•°æ®å®Œæ•´</strong>ï¼šæä¾›ä¸°å¯Œçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¾¿äºé—®é¢˜å®šä½</li></ol> <h3 id="æŠ€æœ¯äº®ç‚¹-8"><a href="#æŠ€æœ¯äº®ç‚¹-8" class="header-anchor">#</a> æŠ€æœ¯äº®ç‚¹</h3> <ol><li><strong>åŸå‹é“¾æ‹¦æˆª</strong>ï¼šé€šè¿‡é‡å†™åŸç”Ÿæ–¹æ³•å®ç°ç›‘æ§</li> <li><strong>äº‹ä»¶æ•è·</strong>ï¼šåˆ©ç”¨äº‹ä»¶å†’æ³¡å’Œæ•è·æœºåˆ¶</li> <li><strong>é‡‡æ ·æ£€æµ‹</strong>ï¼šé€šè¿‡å…³é”®ç‚¹é‡‡æ ·åˆ¤æ–­ç™½å±</li> <li><strong>é˜²æŠ–å¤„ç†</strong>ï¼šé¿å…é¢‘ç¹è¯·æ±‚å’Œä¸ŠæŠ¥</li> <li><strong>é”™è¯¯åˆ†ç±»</strong>ï¼šæ™ºèƒ½åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯</li> <li><strong>ä¸Šä¸‹æ–‡è¿½è¸ª</strong>ï¼šè®°å½•ç”¨æˆ·æ“ä½œè·¯å¾„</li> <li><strong>æ­£åˆ™è§£æ</strong>ï¼šä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è§£æé”™è¯¯ä¿¡æ¯</li> <li><strong>å‡½æ•°å¼ç¼–ç¨‹</strong>ï¼šä½¿ç”¨ç°ä»£JavaScriptå‡½æ•°å¼æ–¹æ³•</li></ol> <h3 id="é€‚ç”¨åœºæ™¯"><a href="#é€‚ç”¨åœºæ™¯" class="header-anchor">#</a> é€‚ç”¨åœºæ™¯</h3> <ul><li><strong>ä¼ä¸šçº§åº”ç”¨</strong>ï¼šéœ€è¦ç¨³å®šæ€§å’Œé”™è¯¯ç›‘æ§çš„Webåº”ç”¨</li> <li><strong>ç§»åŠ¨ç«¯H5</strong>ï¼šéœ€è¦ç›‘æ§ç”¨æˆ·ä½“éªŒçš„ç§»åŠ¨åº”ç”¨</li> <li><strong>ç”µå•†å¹³å°</strong>ï¼šéœ€è¦ç›‘æ§äº¤æ˜“æµç¨‹ç¨³å®šæ€§çš„å¹³å°</li> <li><strong>å†…å®¹ç®¡ç†ç³»ç»Ÿ</strong>ï¼šéœ€è¦ç›‘æ§å†…å®¹åŠ è½½å’Œæ˜¾ç¤ºçš„åº”ç”¨</li></ul> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>è¿™ä¸ªå‰ç«¯æ€§èƒ½ç›‘æ§SDKæ˜¯ä¸€ä¸ªè®¾è®¡ç²¾è‰¯çš„ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p> <h3 id="ğŸ¯-æ ¸å¿ƒä»·å€¼"><a href="#ğŸ¯-æ ¸å¿ƒä»·å€¼" class="header-anchor">#</a> ğŸ¯ æ ¸å¿ƒä»·å€¼</h3> <ol><li><strong>é—®é¢˜å‘ç°</strong>ï¼šè‡ªåŠ¨æ•è·å„ç§å‰ç«¯é”™è¯¯å’Œå¼‚å¸¸</li> <li><strong>é—®é¢˜å®šä½</strong>ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡å’Œå †æ ˆä¿¡æ¯</li> <li><strong>ç”¨æˆ·ä½“éªŒ</strong>ï¼šç›‘æ§ç™½å±ç­‰å½±å“ç”¨æˆ·ä½“éªŒçš„é—®é¢˜</li> <li><strong>æ€§èƒ½ç›‘æ§</strong>ï¼šç»Ÿè®¡ç½‘ç»œè¯·æ±‚æ€§èƒ½æŒ‡æ ‡</li></ol> <h3 id="ğŸ”§-æŠ€æœ¯å®ç°"><a href="#ğŸ”§-æŠ€æœ¯å®ç°" class="header-anchor">#</a> ğŸ”§ æŠ€æœ¯å®ç°</h3> <ol><li><strong>æ¨¡å—åŒ–è®¾è®¡</strong>ï¼šå„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œæ˜“äºç»´æŠ¤</li> <li><strong>è‡ªåŠ¨åŒ–ç›‘æ§</strong>ï¼šæ— éœ€æ‰‹åŠ¨åŸ‹ç‚¹ï¼Œé™ä½ä½¿ç”¨æˆæœ¬</li> <li><strong>ç¯å¢ƒé€‚é…</strong>ï¼šè‡ªåŠ¨åŒºåˆ†ä¸åŒç¯å¢ƒï¼Œæä¾›åˆé€‚çš„å¤„ç†æ–¹å¼</li> <li><strong>æ•°æ®æ ‡å‡†åŒ–</strong>ï¼šç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼Œä¾¿äºåç»­åˆ†æ</li></ol> <h3 id="æ‰©å±•æ€§"><a href="#æ‰©å±•æ€§" class="header-anchor">#</a> æ‰©å±•æ€§</h3> <ol><li><strong>åŠŸèƒ½æ‰©å±•</strong>ï¼šå¯ä»¥è½»æ¾æ·»åŠ æ–°çš„ç›‘æ§åŠŸèƒ½</li> <li><strong>é…ç½®çµæ´»</strong>ï¼šæ”¯æŒé€‰æ‹©æ€§å¯ç”¨ç›‘æ§åŠŸèƒ½</li> <li><strong>æ•°æ®å®šåˆ¶</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦å®šåˆ¶ä¸ŠæŠ¥æ•°æ®æ ¼å¼</li> <li><strong>å¹³å°é€‚é…</strong>ï¼šå¯ä»¥é€‚é…ä¸åŒçš„ä¸ŠæŠ¥å¹³å°</li></ol> <h3 id="æœ€ä½³å®è·µ"><a href="#æœ€ä½³å®è·µ" class="header-anchor">#</a> æœ€ä½³å®è·µ</h3> <ol><li><strong>æ—©æœŸé›†æˆ</strong>ï¼šåœ¨é¡¹ç›®åˆæœŸå°±é›†æˆç›‘æ§SDK</li> <li><strong>ç¯å¢ƒé…ç½®</strong>ï¼šæ­£ç¡®é…ç½®ç”Ÿäº§/æµ‹è¯•ç¯å¢ƒ</li> <li><strong>æ•°æ®ç›‘æ§</strong>ï¼šå®šæœŸæŸ¥çœ‹ç›‘æ§æ•°æ®ï¼ŒåŠæ—¶å‘ç°é—®é¢˜</li> <li><strong>æŒç»­ä¼˜åŒ–</strong>ï¼šæ ¹æ®ç›‘æ§æ•°æ®æŒç»­ä¼˜åŒ–åº”ç”¨æ€§èƒ½</li></ol> <p>è¿™ä¸ªSDKä¸ºå‰ç«¯åº”ç”¨æä¾›äº†åŸºç¡€çš„ç¨³å®šæ€§ç›‘æ§èƒ½åŠ›ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…åŠæ—¶å‘ç°å’Œå®šä½çº¿ä¸Šé—®é¢˜ï¼Œæ˜¯å‰ç«¯åº”ç”¨è´¨é‡ä¿éšœçš„é‡è¦å·¥å…·ã€‚</p> <hr> <h2 id="ğŸ“-æ–‡ä»¶ç»“æ„è¯´æ˜"><a href="#ğŸ“-æ–‡ä»¶ç»“æ„è¯´æ˜" class="header-anchor">#</a> ğŸ“ æ–‡ä»¶ç»“æ„è¯´æ˜</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>view/vue/src-guanjia/public/monitor/
â”œâ”€â”€ index.js              # ç›‘æ§SDKå…¥å£æ–‡ä»¶
â”œâ”€â”€ lib/                   # æ ¸å¿ƒç›‘æ§æ¨¡å—
â”‚   â”œâ”€â”€ jsError.js         # JavaScripté”™è¯¯ç›‘æ§æ¨¡å—
â”‚   â”œâ”€â”€ xhr.js            # ç½‘ç»œè¯·æ±‚ç›‘æ§æ¨¡å—
â”‚   â””â”€â”€ blankScreen.js    # ç™½å±æ£€æµ‹æ¨¡å—
â””â”€â”€ utils/                 # å·¥å…·å‡½æ•°åº“
    â”œâ”€â”€ tracker.js        # æ•°æ®ä¸ŠæŠ¥å™¨
    â”œâ”€â”€ getSelector.js     # DOMé€‰æ‹©å™¨ç”Ÿæˆå·¥å…·
    â”œâ”€â”€ getLastEvent.js   # æœ€åäº¤äº’äº‹ä»¶æ•è·å·¥å…·
    â””â”€â”€ onload.js         # é¡µé¢åŠ è½½å®Œæˆæ£€æµ‹å·¥å…·
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="ğŸ’»-ä»£ç ç¤ºä¾‹"><a href="#ğŸ’»-ä»£ç ç¤ºä¾‹" class="header-anchor">#</a> ğŸ’» ä»£ç ç¤ºä¾‹</h2> <h3 id="å…¥å£æ–‡ä»¶-index-js"><a href="#å…¥å£æ–‡ä»¶-index-js" class="header-anchor">#</a> å…¥å£æ–‡ä»¶ (<code>index.js</code>)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ç›‘æ§å…¥å£æ–‡ä»¶</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectJsError <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./lib/jsError'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectXHR <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./lib/xhr'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> blankScreen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./lib/blankScreen&quot;</span><span class="token punctuation">;</span>

<span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">injectXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="é”™è¯¯ç›‘æ§æ ¸å¿ƒé€»è¾‘"><a href="#é”™è¯¯ç›‘æ§æ ¸å¿ƒé€»è¾‘" class="header-anchor">#</a> é”™è¯¯ç›‘æ§æ ¸å¿ƒé€»è¾‘</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// å…¨å±€é”™è¯¯ç›‘å¬</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span> <span class="token comment">// ç›‘æ§å¤§ç±»</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token comment">// å°ç±»å‹</span>
        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'jsError'</span><span class="token punctuation">,</span> <span class="token comment">// é”™è¯¯ç±»å‹</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">// é”™è¯¯ä¿¡æ¯</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token comment">// å‡ºé”™æ–‡ä»¶</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// è¡Œåˆ—ä¿¡æ¯</span>
        <span class="token literal-property property">stack</span><span class="token operator">:</span> event<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// å †æ ˆ</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// é€‰æ‹©å™¨</span>
    <span class="token punctuation">}</span>
    tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="ç™½å±æ£€æµ‹æ ¸å¿ƒé€»è¾‘"><a href="#ç™½å±æ£€æµ‹æ ¸å¿ƒé€»è¾‘" class="header-anchor">#</a> ç™½å±æ£€æµ‹æ ¸å¿ƒé€»è¾‘</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ç™½å±æ£€æµ‹ç®—æ³•</span>
<span class="token keyword">function</span> <span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> wrapperElements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#container&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.content&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> emptyPoints <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">isWrapper</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            emptyPoints<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// åœ¨é¡µé¢18ä¸ªå…³é”®ç‚¹è¿›è¡Œé‡‡æ ·</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span>
                window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
                window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// å¦‚æœç©ºç™½ç‚¹æ•°é‡å¤§äº16ä¸ªï¼ˆå…±18ä¸ªç‚¹ï¼‰ï¼Œåˆ¤å®šä¸ºç™½å±</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyPoints <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">emptyPoints</span><span class="token operator">:</span> emptyPoints <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">screen</span><span class="token operator">:</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
                <span class="token literal-property property">viewPoint</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
                <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>centerElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/18/2025, 5:05:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/lijun.github.io/blogs/js/åŠŸèƒ½/ç®€æ˜“gpt.html" class="prev">
          ç®€æ˜“gpt
        </a></span> <span class="next"><a href="/lijun.github.io/blogs/js/ä¼˜åŒ–/å›¾ç‰‡æ‡’åŠ è½½.html">
          å›¾ç‰‡æ‡’åŠ è½½
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/lijun.github.io/assets/js/app.d76a9f71.js" defer></script><script src="/lijun.github.io/assets/js/4.7ab4d0b1.js" defer></script><script src="/lijun.github.io/assets/js/1.e1ba0332.js" defer></script><script src="/lijun.github.io/assets/js/50.8eca0d75.js" defer></script>
  </body>
</html>
