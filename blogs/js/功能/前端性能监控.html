<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端性能监控 | lijun&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script src="https://cdn.jsdelivr.net/npm/react/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
    <meta name="description" content="A simple and beautiful vuepress blog theme .">
    
    <link rel="preload" href="/lijun.github.io/assets/css/0.styles.174fb0da.css" as="style"><link rel="preload" href="/lijun.github.io/assets/js/app.d76a9f71.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/4.7ab4d0b1.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/1.e1ba0332.js" as="script"><link rel="preload" href="/lijun.github.io/assets/js/50.8eca0d75.js" as="script"><link rel="prefetch" href="/lijun.github.io/assets/js/10.95f9e478.js"><link rel="prefetch" href="/lijun.github.io/assets/js/11.f6b04fef.js"><link rel="prefetch" href="/lijun.github.io/assets/js/12.3c75d87e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/13.64524e8f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/14.4fe4116d.js"><link rel="prefetch" href="/lijun.github.io/assets/js/15.438923d1.js"><link rel="prefetch" href="/lijun.github.io/assets/js/16.8448211c.js"><link rel="prefetch" href="/lijun.github.io/assets/js/17.9c9379b7.js"><link rel="prefetch" href="/lijun.github.io/assets/js/18.6800bba3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/19.952b82b0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/20.5d0e8bb2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/21.898ecfbd.js"><link rel="prefetch" href="/lijun.github.io/assets/js/22.599b8e17.js"><link rel="prefetch" href="/lijun.github.io/assets/js/23.c4e94cd0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/24.321e8d1e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/25.9861cc00.js"><link rel="prefetch" href="/lijun.github.io/assets/js/26.e0078337.js"><link rel="prefetch" href="/lijun.github.io/assets/js/27.95306eca.js"><link rel="prefetch" href="/lijun.github.io/assets/js/28.359936af.js"><link rel="prefetch" href="/lijun.github.io/assets/js/29.f25cf8ff.js"><link rel="prefetch" href="/lijun.github.io/assets/js/3.f0ed7429.js"><link rel="prefetch" href="/lijun.github.io/assets/js/30.8b33c0af.js"><link rel="prefetch" href="/lijun.github.io/assets/js/31.5ab0875e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/32.dafb4c90.js"><link rel="prefetch" href="/lijun.github.io/assets/js/33.46ef42a6.js"><link rel="prefetch" href="/lijun.github.io/assets/js/34.5958041b.js"><link rel="prefetch" href="/lijun.github.io/assets/js/35.2418e7b8.js"><link rel="prefetch" href="/lijun.github.io/assets/js/36.fc545af4.js"><link rel="prefetch" href="/lijun.github.io/assets/js/37.e2afe675.js"><link rel="prefetch" href="/lijun.github.io/assets/js/38.e21983f2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/39.63fb12b2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/40.15ddf238.js"><link rel="prefetch" href="/lijun.github.io/assets/js/41.907c7b87.js"><link rel="prefetch" href="/lijun.github.io/assets/js/42.7dd9847d.js"><link rel="prefetch" href="/lijun.github.io/assets/js/43.a8eada8a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/44.00a664d6.js"><link rel="prefetch" href="/lijun.github.io/assets/js/45.63795068.js"><link rel="prefetch" href="/lijun.github.io/assets/js/46.334f04fe.js"><link rel="prefetch" href="/lijun.github.io/assets/js/47.24579d27.js"><link rel="prefetch" href="/lijun.github.io/assets/js/48.11de53f2.js"><link rel="prefetch" href="/lijun.github.io/assets/js/49.d2a256fc.js"><link rel="prefetch" href="/lijun.github.io/assets/js/5.36affe12.js"><link rel="prefetch" href="/lijun.github.io/assets/js/51.07584f37.js"><link rel="prefetch" href="/lijun.github.io/assets/js/52.6ace5b78.js"><link rel="prefetch" href="/lijun.github.io/assets/js/53.80ceb25e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/54.c39343a8.js"><link rel="prefetch" href="/lijun.github.io/assets/js/55.b3f4422f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/56.f85dfba9.js"><link rel="prefetch" href="/lijun.github.io/assets/js/57.5ad06130.js"><link rel="prefetch" href="/lijun.github.io/assets/js/58.f2997272.js"><link rel="prefetch" href="/lijun.github.io/assets/js/59.69897d2a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/6.d9bc5b6a.js"><link rel="prefetch" href="/lijun.github.io/assets/js/60.af7ec6d0.js"><link rel="prefetch" href="/lijun.github.io/assets/js/61.f0f798e7.js"><link rel="prefetch" href="/lijun.github.io/assets/js/62.171a615f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/63.41401f9e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/64.5cfee19b.js"><link rel="prefetch" href="/lijun.github.io/assets/js/65.dabe2d1e.js"><link rel="prefetch" href="/lijun.github.io/assets/js/66.82af7c23.js"><link rel="prefetch" href="/lijun.github.io/assets/js/67.4131bc40.js"><link rel="prefetch" href="/lijun.github.io/assets/js/68.c96efc52.js"><link rel="prefetch" href="/lijun.github.io/assets/js/69.3d833570.js"><link rel="prefetch" href="/lijun.github.io/assets/js/7.04cf1173.js"><link rel="prefetch" href="/lijun.github.io/assets/js/70.3d2c5a89.js"><link rel="prefetch" href="/lijun.github.io/assets/js/71.d1076058.js"><link rel="prefetch" href="/lijun.github.io/assets/js/72.b371e547.js"><link rel="prefetch" href="/lijun.github.io/assets/js/73.7b5a1cf3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/74.77cad4ce.js"><link rel="prefetch" href="/lijun.github.io/assets/js/75.30af5ef3.js"><link rel="prefetch" href="/lijun.github.io/assets/js/76.b9691c43.js"><link rel="prefetch" href="/lijun.github.io/assets/js/77.0c45dd6f.js"><link rel="prefetch" href="/lijun.github.io/assets/js/78.456e57be.js"><link rel="prefetch" href="/lijun.github.io/assets/js/8.7ca0fd23.js"><link rel="prefetch" href="/lijun.github.io/assets/js/9.21a31406.js">
    <link rel="stylesheet" href="/lijun.github.io/assets/css/0.styles.174fb0da.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>lijun's blog</h3> <p class="description" data-v-59e6cb88>A simple and beautiful vuepress blog theme .</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>lijun</span>
          
        <span data-v-59e6cb88>2023 - </span>
        2025
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/lijun.github.io/" class="home-link router-link-active"><img src="/lijun.github.io/logo.png" alt="lijun's blog" class="logo"> <span class="site-name">lijun's blog</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/lijun.github.io/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/lijun.github.io/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeScreening
</a></div><div class="nav-item"><a href="/lijun.github.io/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Label
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/js/" class="nav-link router-link-active"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/third_party/" class="nav-link"><i class="undefined"></i>
  thirdPartyPlugin 
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Document
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  个人文档
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/share-work/" class="nav-link"><i class="undefined"></i>
  shareWork
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      GitHub
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lijun-qiu/myblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/lijun.github.io/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    lijun
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>66</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>31</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/lijun.github.io/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><a href="/lijun.github.io/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeScreening
</a></div><div class="nav-item"><a href="/lijun.github.io/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Label
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      Blog
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/vue/" class="nav-link"><i class="undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/react/" class="nav-link"><i class="undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/js/" class="nav-link router-link-active"><i class="undefined"></i>
  js
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/third_party/" class="nav-link"><i class="undefined"></i>
  thirdPartyPlugin 
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/webpack/" class="nav-link"><i class="undefined"></i>
  webpack
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/css/" class="nav-link"><i class="undefined"></i>
  css
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/git/" class="nav-link"><i class="undefined"></i>
  git
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/miniProgram/" class="nav-link"><i class="undefined"></i>
  miniProgram
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Document
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/lijun.github.io/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  个人文档
</a></li><li class="dropdown-item"><!----> <a href="/lijun.github.io/blogs/share-work/" class="nav-link"><i class="undefined"></i>
  shareWork
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      GitHub
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/lijun-qiu/myblog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>功能</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/lijun.github.io/blogs/js/功能/js发布与订阅.html" class="sidebar-link">js发布与订阅</a></li><li><a href="/lijun.github.io/blogs/js/功能/封装storage.html" class="sidebar-link">封装storage</a></li><li><a href="/lijun.github.io/blogs/js/功能/展开收起效果.html" class="sidebar-link">css展开收起</a></li><li><a href="/lijun.github.io/blogs/js/功能/文字向上轮播.html" class="sidebar-link">文字向上轮播</a></li><li><a href="/lijun.github.io/blogs/js/功能/轮播图.html" class="sidebar-link">轮播图</a></li><li><a href="/lijun.github.io/blogs/js/功能/悬浮隐藏加拖动.html" class="sidebar-link">悬浮隐藏加拖动</a></li><li><a href="/lijun.github.io/blogs/js/功能/h5下拉刷新.html" class="sidebar-link">h5下拉刷新</a></li><li><a href="/lijun.github.io/blogs/js/功能/简易gpt.html" class="sidebar-link">简易gpt</a></li><li><a href="/lijun.github.io/blogs/js/功能/前端性能监控.html" class="active sidebar-link">前端性能监控</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数组</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>第三方插件</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>前端性能监控</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>lijun</span>
          
        <span data-v-59e6cb88>2023 - </span>
        2025
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page" style="padding-right:0;"><section style="display:;"><div class="page-title"><h1 class="title">前端性能监控</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>lijun</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>8/18/2024</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>前端性能监控</span></i></div></div> <div class="theme-reco-content content__default"><h1 id="前端性能监控sdk-详细分析"><a href="#前端性能监控sdk-详细分析" class="header-anchor">#</a> 前端性能监控SDK 详细分析</h1> <h2 id="📋-目录"><a href="#📋-目录" class="header-anchor">#</a> 📋 目录</h2> <ul><li><a href="#%E9%A1%B9%E7%9B%AE%E6%A6%82%E8%BF%B0">项目概述</a></li> <li><a href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">架构设计</a></li> <li><a href="#%E6%A0%B8%E5%BF%83%E6%A8%A1%E5%9D%97%E8%AF%A6%E8%A7%A3">核心模块详解</a></li> <li><a href="#%E5%B7%A5%E5%85%B7%E5%87%BD%E6%95%B0%E5%88%86%E6%9E%90">工具函数分析</a></li> <li><a href="#%E6%95%B0%E6%8D%AE%E6%B5%81%E5%88%86%E6%9E%90">数据流分析</a></li> <li><a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F">使用方式</a></li> <li><a href="#%E6%8A%80%E6%9C%AF%E7%89%B9%E7%82%B9">技术特点</a></li> <li><a href="#%E6%80%BB%E7%BB%93">总结</a></li></ul> <h2 id="项目概述"><a href="#项目概述" class="header-anchor">#</a> 项目概述</h2> <p>这是一个轻量级的前端性能监控SDK，专门用于监控Web应用的稳定性和错误情况。该SDK采用模块化设计，能够自动捕获JavaScript错误、网络请求异常、白屏问题等关键监控指标，为开发者提供全面的前端应用健康状态监控。</p> <h3 id="��-监控目标"><a href="#��-监控目标" class="header-anchor">#</a> �� 监控目标</h3> <ul><li><strong>稳定性监控</strong>：JS错误、资源加载错误、Promise错误</li> <li><strong>网络监控</strong>：XHR请求异常、响应时间统计</li> <li><strong>用户体验监控</strong>：白屏检测、页面可用性</li> <li><strong>错误定位</strong>：提供详细的错误上下文信息</li></ul> <h2 id="架构设计"><a href="#架构设计" class="header-anchor">#</a> 架构设计</h2> <h3 id="整体架构图"><a href="#整体架构图" class="header-anchor">#</a> 整体架构图</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>monitor/
├── index.js              # 统一入口，初始化所有监控模块
├── lib/                   # 核心监控功能模块
│   ├── jsError.js         # JavaScript错误监控
│   ├── xhr.js            # 网络请求监控
│   └── blankScreen.js    # 白屏检测
└── utils/                 # 工具函数库
    ├── tracker.js        # 数据上报器
    ├── getSelector.js     # DOM选择器生成
    ├── getLastEvent.js   # 最后交互事件捕获
    └── onload.js         # 页面加载完成检测
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="模块依赖关系"><a href="#模块依赖关系" class="header-anchor">#</a> 模块依赖关系</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>index.js (入口)
├── jsError.js → getSelector.js, getLastEvent.js, tracker.js
├── xhr.js → tracker.js
└── blankScreen.js → tracker.js, onload.js
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="核心模块详解"><a href="#核心模块详解" class="header-anchor">#</a> 核心模块详解</h2> <h3 id="_1-javascript错误监控-jserror-js"><a href="#_1-javascript错误监控-jserror-js" class="header-anchor">#</a> 1. JavaScript错误监控 (<code>jsError.js</code>)</h3> <h4 id="功能概述"><a href="#功能概述" class="header-anchor">#</a> 功能概述</h4> <p>负责捕获和处理JavaScript运行时错误，包括同步错误、异步错误和资源加载错误。</p> <h4 id="核心实现"><a href="#核心实现" class="header-anchor">#</a> 核心实现</h4> <p><strong>全局错误监听</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 捕获最后一个交互事件</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span> event<span class="token punctuation">.</span>target <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 资源加载错误处理</span>
        <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'resourceError'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
            <span class="token literal-property property">tagName</span><span class="token operator">:</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>tagName<span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment">// JS执行错误处理</span>
        <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'jsError'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">message</span><span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
            <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span>
            <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">stack</span><span class="token operator">:</span> event<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
        <span class="token punctuation">}</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><strong>Promise错误捕获</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> message<span class="token punctuation">;</span>
    <span class="token keyword">let</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
    <span class="token keyword">let</span> lineno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> colno <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> filename<span class="token punctuation">;</span>
    <span class="token keyword">let</span> stack<span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> event<span class="token punctuation">.</span>reason <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        message <span class="token operator">=</span> reason<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> reason <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> matchResult <span class="token operator">=</span> reason<span class="token punctuation">.</span>stack<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">at\s+(.+):(\d+):(\d+)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            filename <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            lineno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            colno <span class="token operator">=</span> matchResult<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        message <span class="token operator">=</span> reason<span class="token punctuation">.</span>message<span class="token punctuation">;</span>
        stack <span class="token operator">=</span> <span class="token function">getLines</span><span class="token punctuation">(</span>reason<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'promiseError'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> message<span class="token punctuation">,</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> filename<span class="token punctuation">,</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">stack</span><span class="token operator">:</span> stack<span class="token punctuation">,</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
    tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><strong>堆栈信息处理</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getLines</span><span class="token punctuation">(</span><span class="token parameter">stack</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> stack<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token operator">=&gt;</span>item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\s+at\s+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'^'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="监控数据类型"><a href="#监控数据类型" class="header-anchor">#</a> 监控数据类型</h4> <ul><li><p><strong>JS执行错误</strong> (<code>errorType: 'jsError'</code>)</p> <ul><li>错误消息 (<code>message</code>)</li> <li>文件名 (<code>filename</code>)</li> <li>错误位置 (<code>position: &quot;行:列&quot;</code>)</li> <li>堆栈信息 (<code>stack</code>)</li> <li>最后操作元素 (<code>selector</code>)</li></ul></li> <li><p><strong>资源加载错误</strong> (<code>errorType: 'resourceError'</code>)</p> <ul><li>资源URL (<code>filename</code>)</li> <li>标签名 (<code>tagName</code>)</li> <li>元素选择器 (<code>selector</code>)</li></ul></li> <li><p><strong>Promise错误</strong> (<code>errorType: 'promiseError'</code>)</p> <ul><li>错误消息和堆栈信息</li> <li>文件名和位置信息</li></ul></li></ul> <h4 id="技术亮点"><a href="#技术亮点" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>错误分类</strong>：自动区分不同类型的错误</li> <li><strong>堆栈解析</strong>：提取并格式化错误堆栈信息</li> <li><strong>上下文捕获</strong>：记录用户最后操作的元素</li> <li><strong>正则匹配</strong>：通过正则表达式解析Promise错误信息</li></ul> <h3 id="_2-网络请求监控-xhr-js"><a href="#_2-网络请求监控-xhr-js" class="header-anchor">#</a> 2. 网络请求监控 (<code>xhr.js</code>)</h3> <h4 id="功能概述-2"><a href="#功能概述-2" class="header-anchor">#</a> 功能概述</h4> <p>通过拦截XMLHttpRequest来监控网络请求的状态、性能和错误情况。</p> <h4 id="核心实现-2"><a href="#核心实现-2" class="header-anchor">#</a> 核心实现</h4> <p><strong>请求拦截</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> XMLHttpRequest <span class="token operator">=</span> window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">;</span>
<span class="token keyword">let</span> oldOpen <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>open<span class="token punctuation">;</span>
<span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">open</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token keyword">async</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 把上报接口过滤掉，避免循环上报</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>url<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">plaque_log</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>logData <span class="token operator">=</span> <span class="token punctuation">{</span> method<span class="token punctuation">,</span> url<span class="token punctuation">,</span> async <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldOpen</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>响应监控</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> oldSend <span class="token operator">=</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>send<span class="token punctuation">;</span>
<span class="token class-name">XMLHttpRequest</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">send</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 发送前记录开始时间</span>
        <span class="token keyword">let</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 持续时间</span>
            <span class="token keyword">let</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
            <span class="token keyword">let</span> status <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>status<span class="token punctuation">;</span>  <span class="token comment">// 200 500</span>
            <span class="token keyword">let</span> statusText <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">;</span>  <span class="token comment">// Ok Server Error</span>
            
            <span class="token comment">// 接口请求监控</span>
            tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;xhr&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">eventType</span><span class="token operator">:</span> type<span class="token punctuation">,</span>  <span class="token comment">// load, error, abort 请求类型</span>
                <span class="token literal-property property">pathname</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>logData<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
                <span class="token literal-property property">status</span><span class="token operator">:</span> status <span class="token operator">+</span> <span class="token string">&quot;-&quot;</span> <span class="token operator">+</span> statusText<span class="token punctuation">,</span>
                duration<span class="token punctuation">,</span>
                <span class="token literal-property property">response</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>response <span class="token operator">?</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">params</span><span class="token operator">:</span> body <span class="token operator">||</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 监听成功，失败，的所有接口，这里只监控error </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token function">handler</span><span class="token punctuation">(</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">oldSend</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="监控数据类型-2"><a href="#监控数据类型-2" class="header-anchor">#</a> 监控数据类型</h4> <ul><li><strong>请求信息</strong>：方法、URL、异步标志</li> <li><strong>响应信息</strong>：状态码、状态文本、响应内容</li> <li><strong>性能指标</strong>：请求持续时间</li> <li><strong>错误类型</strong>：error事件</li></ul> <h4 id="技术亮点-2"><a href="#技术亮点-2" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>原型链拦截</strong>：通过重写XMLHttpRequest原型方法实现监控</li> <li><strong>循环上报防护</strong>：过滤监控接口本身，避免无限循环</li> <li><strong>性能统计</strong>：精确计算请求耗时</li> <li><strong>选择性监控</strong>：只监控error事件，减少数据量</li> <li><strong>时间记录</strong>：在send方法中记录开始时间</li></ul> <h3 id="_3-白屏检测-blankscreen-js"><a href="#_3-白屏检测-blankscreen-js" class="header-anchor">#</a> 3. 白屏检测 (<code>blankScreen.js</code>)</h3> <h4 id="功能概述-3"><a href="#功能概述-3" class="header-anchor">#</a> 功能概述</h4> <p>通过采样检测页面关键位置来判断是否存在白屏问题。</p> <h4 id="核心实现-3"><a href="#核心实现-3" class="header-anchor">#</a> 核心实现</h4> <p><strong>选择器生成</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getSelector</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>id<span class="token punctuation">,</span> className<span class="token punctuation">,</span> nodeName<span class="token punctuation">}</span> <span class="token operator">=</span> element<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> id<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>className<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 过滤空白符 + 拼接 可能多个className  a  b   c =&gt; .a.b.c</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span> <span class="token operator">+</span> className <span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token operator">!</span>item<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p><strong>采样检测算法</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isWrapper</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        emptyPoints<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 刚开始页面内容为空，监听接口加载，等页面渲染完成，再去做判断</span>
<span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> xElements<span class="token punctuation">,</span> yElements<span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// 白屏 总共18个点  如果空白点数量大于 16个 代表白屏</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyPoints <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> centerElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
            window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
            window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 白屏监控</span>
        tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">emptyPoints</span><span class="token operator">:</span> emptyPoints <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">screen</span><span class="token operator">:</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            <span class="token literal-property property">viewPoint</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
            <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>centerElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h4 id="监控数据类型-3"><a href="#监控数据类型-3" class="header-anchor">#</a> 监控数据类型</h4> <ul><li><strong>空白点数量</strong> (<code>emptyPoints</code>)</li> <li><strong>屏幕分辨率</strong> (<code>screen</code>)</li> <li><strong>视口大小</strong> (<code>viewPoint</code>)</li> <li><strong>中心点选择器</strong> (<code>selector</code>)</li></ul> <h4 id="技术亮点-3"><a href="#技术亮点-3" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>十字型采样</strong>：在页面关键位置进行采样检测</li> <li><strong>延迟检测</strong>：等待页面完全加载后再检测</li> <li><strong>阈值判断</strong>：通过空白点数量阈值判断白屏</li> <li><strong>环境信息</strong>：记录屏幕和视口信息</li> <li><strong>elementsFromPoint API</strong>：使用现代API获取指定位置元素</li></ul> <h2 id="工具函数分析"><a href="#工具函数分析" class="header-anchor">#</a> 工具函数分析</h2> <h3 id="_1-数据上报器-tracker-js"><a href="#_1-数据上报器-tracker-js" class="header-anchor">#</a> 1. 数据上报器 (<code>tracker.js</code>)</h3> <h4 id="功能概述-4"><a href="#功能概述-4" class="header-anchor">#</a> 功能概述</h4> <p>统一的数据上报模块，负责收集和发送监控数据。</p> <h4 id="核心实现-4"><a href="#核心实现-4" class="header-anchor">#</a> 核心实现</h4> <p><strong>公共信息收集</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getExtraData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">title</span><span class="token operator">:</span> document<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment">// 当前浏览器title</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> location<span class="token punctuation">.</span>href<span class="token punctuation">,</span>  <span class="token comment">// 访问路径</span>
        <span class="token literal-property property">timestamp</span><span class="token operator">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 当前时间戳</span>
        <span class="token literal-property property">userAgent</span><span class="token operator">:</span> userAgent<span class="token punctuation">,</span> <span class="token comment">// 浏览器信息</span>
        <span class="token literal-property property">uid</span><span class="token operator">:</span> store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>uid <span class="token operator">??</span> <span class="token string">''</span><span class="token punctuation">,</span>  <span class="token comment">// 当前用户id</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>数据标准化</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 对象的值统一为字符串</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> log<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> log<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        log<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>log<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>环境区分上报</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>href<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">shuidi.cn</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 生产环境上报信息</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异常监控上报: '</span> <span class="token operator">+</span> log<span class="token punctuation">.</span>type<span class="token punctuation">,</span> log<span class="token punctuation">)</span>
    axios<span class="token punctuation">.</span>http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/kp/plaque_log'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">action</span><span class="token operator">:</span> <span class="token string">'front_error_log'</span><span class="token punctuation">,</span>
        log<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token comment">// 测试环境监控提示</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'异常信息监控提示: '</span> <span class="token operator">+</span> log<span class="token punctuation">.</span>type<span class="token punctuation">,</span> log<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="技术亮点-4"><a href="#技术亮点-4" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>环境自适应</strong>：自动区分生产/测试环境</li> <li><strong>数据标准化</strong>：统一数据格式</li> <li><strong>用户信息集成</strong>：自动附加用户上下文</li> <li><strong>错误处理</strong>：提供降级方案</li> <li><strong>单例模式</strong>：使用new SendTracker()确保全局唯一</li></ul> <h3 id="_2-dom选择器生成-getselector-js"><a href="#_2-dom选择器生成-getselector-js" class="header-anchor">#</a> 2. DOM选择器生成 (<code>getSelector.js</code>)</h3> <h4 id="功能概述-5"><a href="#功能概述-5" class="header-anchor">#</a> 功能概述</h4> <p>生成DOM元素的完整选择器路径，用于错误定位。</p> <h4 id="核心实现-5"><a href="#核心实现-5" class="header-anchor">#</a> 核心实现</h4> <p><strong>路径构建算法</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 反转 + 过滤 + 映射 + 拼接</span>
    <span class="token keyword">return</span> path
        <span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> element <span class="token operator">!==</span> document <span class="token operator">&amp;&amp;</span> element <span class="token operator">!==</span> window<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;element&quot;</span><span class="token punctuation">,</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">#</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>element<span class="token punctuation">.</span>className <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> element<span class="token punctuation">.</span>className <span class="token operator">===</span> <span class="token string">&quot;string&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>element<span class="token punctuation">.</span>className<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                selector <span class="token operator">=</span> element<span class="token punctuation">.</span>nodeName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">pathsOrTarget</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            path<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>pathsOrTarget<span class="token punctuation">)</span><span class="token punctuation">;</span>
            pathsOrTarget <span class="token operator">=</span> pathsOrTarget<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">getSelectors</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h4 id="技术亮点-5"><a href="#技术亮点-5" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>优先级处理</strong>：ID &gt; className &gt; tagName</li> <li><strong>路径反转</strong>：从子元素到父元素</li> <li><strong>过滤处理</strong>：排除document和window对象</li> <li><strong>兼容性处理</strong>：支持不同元素类型</li> <li><strong>递归遍历</strong>：通过parentNode向上遍历DOM树</li> <li><strong>函数式编程</strong>：使用map、filter、join等函数式方法</li></ul> <h3 id="_3-交互事件捕获-getlastevent-js"><a href="#_3-交互事件捕获-getlastevent-js" class="header-anchor">#</a> 3. 交互事件捕获 (<code>getLastEvent.js</code>)</h3> <h4 id="功能概述-6"><a href="#功能概述-6" class="header-anchor">#</a> 功能概述</h4> <p>捕获用户最后的交互事件，为错误提供上下文信息。</p> <h4 id="核心实现-6"><a href="#核心实现-6" class="header-anchor">#</a> 核心实现</h4> <p><strong>事件监听</strong></p> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> lastEvent<span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token string">'touchstart'</span><span class="token punctuation">,</span> <span class="token string">'mousedown'</span><span class="token punctuation">,</span> <span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token string">'mouseover'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">eventType</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>eventType<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            lastEvent <span class="token operator">=</span> event<span class="token punctuation">;</span>
            <span class="token comment">// html5之前使用mouseEvent.path等获取事件位置，</span>
            <span class="token comment">// html5之后所有事件使用 PointerEven 替代，取消path</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">capture</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 捕获阶段执行 防止事件丢失</span>
            <span class="token literal-property property">passive</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认不阻止默认事件</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> lastEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="技术亮点-6"><a href="#技术亮点-6" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>多事件监听</strong>：覆盖主要用户交互事件</li> <li><strong>捕获阶段执行</strong>：防止事件丢失</li> <li><strong>被动监听</strong>：不阻止默认事件</li> <li><strong>HTML5兼容</strong>：处理新旧标准差异</li> <li><strong>全局状态</strong>：使用模块级变量保存最后事件</li></ul> <h3 id="_4-页面加载检测-onload-js"><a href="#_4-页面加载检测-onload-js" class="header-anchor">#</a> 4. 页面加载检测 (<code>onload.js</code>)</h3> <h4 id="功能概述-7"><a href="#功能概述-7" class="header-anchor">#</a> 功能概述</h4> <p>检测页面是否完全加载完成。</p> <h4 id="核心实现-7"><a href="#核心实现-7" class="header-anchor">#</a> 核心实现</h4> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token string">&quot;complete&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="技术亮点-7"><a href="#技术亮点-7" class="header-anchor">#</a> 技术亮点</h4> <ul><li><strong>状态检查</strong>：优先检查readyState</li> <li><strong>事件监听</strong>：备用load事件监听</li> <li><strong>简洁设计</strong>：最小化实现</li> <li><strong>回调模式</strong>：支持异步回调</li></ul> <h2 id="数据流分析"><a href="#数据流分析" class="header-anchor">#</a> 数据流分析</h2> <h3 id="数据收集流程"><a href="#数据收集流程" class="header-anchor">#</a> 数据收集流程</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>用户操作 → 事件捕获 → 错误发生 → 错误监听 → 数据收集 → 格式化 → 上报
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="数据格式标准"><a href="#数据格式标准" class="header-anchor">#</a> 数据格式标准</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token comment">// 公共信息</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;页面标题&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;当前URL&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token string">&quot;时间戳&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">&quot;浏览器信息&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">uid</span><span class="token operator">:</span> <span class="token string">&quot;用户ID&quot;</span><span class="token punctuation">,</span>
    
    <span class="token comment">// 监控数据</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>           <span class="token comment">// 日志种类</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;error|xhr|blank&quot;</span><span class="token punctuation">,</span>     <span class="token comment">// 监控类型</span>
    <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">&quot;jsError|resourceError|promiseError&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 错误子类型</span>
    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;错误消息&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;文件名&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token string">&quot;行:列&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">stack</span><span class="token operator">:</span> <span class="token string">&quot;堆栈信息&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token string">&quot;元素选择器&quot;</span><span class="token punctuation">,</span>
    <span class="token comment">// ... 其他字段</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="上报策略"><a href="#上报策略" class="header-anchor">#</a> 上报策略</h3> <ul><li><strong>实时上报</strong>：错误发生时立即上报</li> <li><strong>环境区分</strong>：生产环境真实上报，测试环境控制台输出</li> <li><strong>数据过滤</strong>：排除监控接口本身，避免循环上报</li></ul> <h2 id="使用方式"><a href="#使用方式" class="header-anchor">#</a> 使用方式</h2> <h3 id="基础使用"><a href="#基础使用" class="header-anchor">#</a> 基础使用</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 在应用入口引入即可自动开始监控</span>
<span class="token keyword">import</span> <span class="token string">'./monitor/index.js'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="自定义配置"><a href="#自定义配置" class="header-anchor">#</a> 自定义配置</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 可以扩展监控功能</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectJsError <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./monitor/lib/jsError'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectXHR <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./monitor/lib/xhr'</span><span class="token punctuation">;</span>

<span class="token comment">// 选择性启用监控</span>
<span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// injectXHR(); // 注释掉不需要的监控</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="技术特点"><a href="#技术特点" class="header-anchor">#</a> 技术特点</h2> <h3 id="优势"><a href="#优势" class="header-anchor">#</a> 优势</h3> <ol><li><strong>轻量级设计</strong>：代码简洁，性能影响小</li> <li><strong>模块化架构</strong>：功能独立，易于维护和扩展</li> <li><strong>自动化监控</strong>：无需手动埋点，自动捕获异常</li> <li><strong>全面覆盖</strong>：涵盖JS错误、网络请求、白屏等关键监控点</li> <li><strong>环境适配</strong>：自动区分生产/测试环境</li> <li><strong>数据完整</strong>：提供丰富的上下文信息便于问题定位</li></ol> <h3 id="技术亮点-8"><a href="#技术亮点-8" class="header-anchor">#</a> 技术亮点</h3> <ol><li><strong>原型链拦截</strong>：通过重写原生方法实现监控</li> <li><strong>事件捕获</strong>：利用事件冒泡和捕获机制</li> <li><strong>采样检测</strong>：通过关键点采样判断白屏</li> <li><strong>防抖处理</strong>：避免频繁请求和上报</li> <li><strong>错误分类</strong>：智能区分不同类型的错误</li> <li><strong>上下文追踪</strong>：记录用户操作路径</li> <li><strong>正则解析</strong>：使用正则表达式解析错误信息</li> <li><strong>函数式编程</strong>：使用现代JavaScript函数式方法</li></ol> <h3 id="适用场景"><a href="#适用场景" class="header-anchor">#</a> 适用场景</h3> <ul><li><strong>企业级应用</strong>：需要稳定性和错误监控的Web应用</li> <li><strong>移动端H5</strong>：需要监控用户体验的移动应用</li> <li><strong>电商平台</strong>：需要监控交易流程稳定性的平台</li> <li><strong>内容管理系统</strong>：需要监控内容加载和显示的应用</li></ul> <h2 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h2> <p>这个前端性能监控SDK是一个设计精良的监控解决方案，具有以下特点：</p> <h3 id="🎯-核心价值"><a href="#🎯-核心价值" class="header-anchor">#</a> 🎯 核心价值</h3> <ol><li><strong>问题发现</strong>：自动捕获各种前端错误和异常</li> <li><strong>问题定位</strong>：提供详细的错误上下文和堆栈信息</li> <li><strong>用户体验</strong>：监控白屏等影响用户体验的问题</li> <li><strong>性能监控</strong>：统计网络请求性能指标</li></ol> <h3 id="🔧-技术实现"><a href="#🔧-技术实现" class="header-anchor">#</a> 🔧 技术实现</h3> <ol><li><strong>模块化设计</strong>：各功能模块独立，易于维护</li> <li><strong>自动化监控</strong>：无需手动埋点，降低使用成本</li> <li><strong>环境适配</strong>：自动区分不同环境，提供合适的处理方式</li> <li><strong>数据标准化</strong>：统一的数据格式，便于后续分析</li></ol> <h3 id="扩展性"><a href="#扩展性" class="header-anchor">#</a> 扩展性</h3> <ol><li><strong>功能扩展</strong>：可以轻松添加新的监控功能</li> <li><strong>配置灵活</strong>：支持选择性启用监控功能</li> <li><strong>数据定制</strong>：可以根据需要定制上报数据格式</li> <li><strong>平台适配</strong>：可以适配不同的上报平台</li></ol> <h3 id="最佳实践"><a href="#最佳实践" class="header-anchor">#</a> 最佳实践</h3> <ol><li><strong>早期集成</strong>：在项目初期就集成监控SDK</li> <li><strong>环境配置</strong>：正确配置生产/测试环境</li> <li><strong>数据监控</strong>：定期查看监控数据，及时发现问题</li> <li><strong>持续优化</strong>：根据监控数据持续优化应用性能</li></ol> <p>这个SDK为前端应用提供了基础的稳定性监控能力，能够帮助开发者及时发现和定位线上问题，是前端应用质量保障的重要工具。</p> <hr> <h2 id="📁-文件结构说明"><a href="#📁-文件结构说明" class="header-anchor">#</a> 📁 文件结构说明</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>view/vue/src-guanjia/public/monitor/
├── index.js              # 监控SDK入口文件
├── lib/                   # 核心监控模块
│   ├── jsError.js         # JavaScript错误监控模块
│   ├── xhr.js            # 网络请求监控模块
│   └── blankScreen.js    # 白屏检测模块
└── utils/                 # 工具函数库
    ├── tracker.js        # 数据上报器
    ├── getSelector.js     # DOM选择器生成工具
    ├── getLastEvent.js   # 最后交互事件捕获工具
    └── onload.js         # 页面加载完成检测工具
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="💻-代码示例"><a href="#💻-代码示例" class="header-anchor">#</a> 💻 代码示例</h2> <h3 id="入口文件-index-js"><a href="#入口文件-index-js" class="header-anchor">#</a> 入口文件 (<code>index.js</code>)</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 监控入口文件</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectJsError <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./lib/jsError'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> injectXHR <span class="token punctuation">}</span> <span class="token keyword">from</span>  <span class="token string">'./lib/xhr'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> blankScreen <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./lib/blankScreen&quot;</span><span class="token punctuation">;</span>

<span class="token function">injectJsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">injectXHR</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="错误监控核心逻辑"><a href="#错误监控核心逻辑" class="header-anchor">#</a> 错误监控核心逻辑</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 全局错误监听</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> lastEvent <span class="token operator">=</span> <span class="token function">getLastEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> errorLog <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">'stability'</span><span class="token punctuation">,</span> <span class="token comment">// 监控大类</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token comment">// 小类型</span>
        <span class="token literal-property property">errorType</span><span class="token operator">:</span> <span class="token string">'jsError'</span><span class="token punctuation">,</span> <span class="token comment">// 错误类型</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> event<span class="token punctuation">.</span>message<span class="token punctuation">,</span> <span class="token comment">// 错误信息</span>
        <span class="token literal-property property">filename</span><span class="token operator">:</span> event<span class="token punctuation">.</span>filename<span class="token punctuation">,</span> <span class="token comment">// 出错文件</span>
        <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>lineno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>colno<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">// 行列信息</span>
        <span class="token literal-property property">stack</span><span class="token operator">:</span> event<span class="token punctuation">.</span>error <span class="token operator">&amp;&amp;</span> <span class="token function">getLines</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>error<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 堆栈</span>
        <span class="token literal-property property">selector</span><span class="token operator">:</span> lastEvent <span class="token operator">?</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>lastEvent<span class="token punctuation">.</span>path<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 选择器</span>
    <span class="token punctuation">}</span>
    tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>errorLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="白屏检测核心逻辑"><a href="#白屏检测核心逻辑" class="header-anchor">#</a> 白屏检测核心逻辑</h3> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 白屏检测算法</span>
<span class="token keyword">function</span> <span class="token function">blankScreen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> wrapperElements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;html&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;body&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;#container&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.content&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> emptyPoints <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">isWrapper</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> selector <span class="token operator">=</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>wrapperElements<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>selector<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            emptyPoints<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token function">onload</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在页面18个关键点进行采样</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">9</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> xElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
                <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerWidth <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">,</span>
                window<span class="token punctuation">.</span>innerHeight <span class="token operator">/</span> <span class="token number">2</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> yElements <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">elementsFromPoint</span><span class="token punctuation">(</span>
                window<span class="token punctuation">.</span>innerWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>
                <span class="token punctuation">(</span>window<span class="token punctuation">.</span>innerHeight <span class="token operator">*</span> i<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">10</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">isWrapper</span><span class="token punctuation">(</span>xElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">isWrapper</span><span class="token punctuation">(</span>yElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 如果空白点数量大于16个（共18个点），判定为白屏</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>emptyPoints <span class="token operator">&gt;=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tracker<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;stability&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;blank&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">emptyPoints</span><span class="token operator">:</span> emptyPoints <span class="token operator">+</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
                <span class="token literal-property property">screen</span><span class="token operator">:</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>screen<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
                <span class="token literal-property property">viewPoint</span><span class="token operator">:</span> window<span class="token punctuation">.</span>innerWidth <span class="token operator">+</span> <span class="token string">&quot;X&quot;</span> <span class="token operator">+</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">,</span>
                <span class="token literal-property property">selector</span><span class="token operator">:</span> <span class="token function">getSelector</span><span class="token punctuation">(</span>centerElements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">9/18/2025, 5:05:56 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/lijun.github.io/blogs/js/功能/简易gpt.html" class="prev">
          简易gpt
        </a></span> <span class="next"><a href="/lijun.github.io/blogs/js/优化/图片懒加载.html">
          图片懒加载
        </a></span></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:0;" data-v-b57cc07c data-v-7dd95ae2></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/lijun.github.io/assets/js/app.d76a9f71.js" defer></script><script src="/lijun.github.io/assets/js/4.7ab4d0b1.js" defer></script><script src="/lijun.github.io/assets/js/1.e1ba0332.js" defer></script><script src="/lijun.github.io/assets/js/50.8eca0d75.js" defer></script>
  </body>
</html>
